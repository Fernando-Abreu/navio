// https://github.com/john-guerra/Navio#readme v0.0.14 Copyright 2019 John Alexis Guerra GÃ³mez
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3"),require("d3-scale-chromatic")):"function"==typeof define&&define.amd?define(["d3","d3-scale-chromatic"],t):e.navio=t(e.d3,e.d3ScaleChromatic)}(this,function(e,t){"use strict";return function(n,a){var r,o,i,l,s,c=this||{},d=[],u=[],f=e.map(),v=e.map(),p=[],h=e.map(),g=e.map(),m=[],b=void 0!==a?a:600,y=e.map(),x="interpolateBlues"in e?e.interpolateBlues:t.interpolateBlues,w=["white","#b5cf6b"],_=e.format(",.0d"),S=0,T=100,k="__seqId",C=function(){};function A(){e.event.preventDefault()}c.margin=10,c.attribWidth=15,c.levelsSeparation=40,c.divisionsColor="white",c.levelConvectionsColor="rgba(205, 220, 163, 0.5)",c.divisionsThreshold=4,c.attribFontSize=13,c.attribFontSizeSelected=32,c.startColor="white",c.endColor="red",c.legendFont="14px Arial",c.linkColor="#2171b5",(n=void 0===(n="string"==typeof n?e.select(n):n).selectAll?e.select(n):n).selectAll("*").remove(),n.on("touchstart",A).on("touchmove",A).style("height",b+"px").attr("class","navio").append("div").attr("id","navio").style("position","relative"),n.select("#navio").append("canvas");var E=n.select("#navio").append("svg").style("overflow","visible").style("position","absolute").style("z-index",99).style("top",0).style("left",0);E.append("g").attr("class","attribs"),E.append("g").attr("class","nvTooltip").style("text-shadow","0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff").attr("transform","translate(-100,-10)").append("text").attr("x",0).attr("y",0).style("pointer-events","none").style("font-family","sans-serif").style("font-size","16pt").style("text-anchor","middle"),E.select(".nvTooltip > text").append("tspan").attr("class","tool_id").attr("x",0).attr("dy","1.2em"),E.select(".nvTooltip > text").append("tspan").attr("class","tool_value_name").style("font-weight","bold").attr("x",0).attr("dy","1.2em"),E.select(".nvTooltip > text").append("tspan").attr("class","tool_value_val").style("font-weight","bold").attr("x",0).attr("dy","1.2em"),E.append("g").attr("id","closeButton").style("fill","white").style("stroke","black").style("display","none").append("path").call(function(t){var n=e.path();n.moveTo(0,0),n.lineTo(7,7),n.moveTo(7,0),n.lineTo(0,7),n.moveTo(11.9,3.5),n.arc(3.5,3.5,8.4,0,2*Math.PI),t.attr("d",n.toString())}).on("click",function(){u.length<=1||(P(u.length-2),u[u.length-2].forEach(function(e){d[e].visible=!0}),u=u.slice(0,u.length-1),c.updateData(u,y),C(c.getVisible()))}),r=e.scaleBand().range([0,c.attribWidth]).round(!0).paddingInner(.1).paddingOuter(0),i=e.scaleBand().round(!0),y=e.map(),o=function(e,t){return i(t)+r(e)},(l=n.select("canvas").node()).style.top=l.offsetTop+"px",l.style.left=l.offsetLeft+"px",l.style.height=b+"px";const z=window.devicePixelRatio;function I(t,n){var a=t.domain(),r=t.range();return e.scaleQuantize().domain(r).range(a)(n)}function O(t){e.event&&e.event.defaultPrevented||(performance.now(),u[t.level]=u[t.level].sort(function(n,a){return e.ascending(d[n][t.attrib],d[a][t.attrib])}),u[t.level].forEach(function(e,n){d[e].__i[t.level]=n}),performance.now(),h.set(t.level,t.attrib),c.updateData(u,y,t.level))}function P(t){e.select("#level"+t).selectAll(".brush").call(g.get(t).move,null)}function q(e){for(var t=0;t<u.length;t+=1)t!==e&&P(t)}function D(t,n){g.set(n,e.brushY().extent([[o(r.domain()[0],n),m[n].range()[0]],[o(r.domain()[r.domain().length-1],n)+1.1*r.bandwidth(),m[n].range()[1]]]).on("end",function(){if(e.event.sourceEvent&&e.event.selection){q(n),performance.now();for(var t=e.event.selection,a=f.get(I(m[n],t[0])),r=f.get(I(m[n],t[1])),o=u[n].filter(function(e){return d[e].visible=d[e].__i[n]>=a.__i[n]&&d[e].__i[n]<=r.__i[n],d[e].visible}),i=0;i<o.length;i++)d[o[i]].__i[n+1]=i;performance.now();var l=u;0!==o.length&&((l=u.slice(0,n+1)).push(o),c.updateData(l,y),C(c.getVisible()))}}));var a=e.select(this).selectAll(".brush").data([{data:d[t],level:n}]);a.enter().merge(a).append("g").on("mousemove",F).on("click",function(){var t=e.mouse(e.event.target)[1];!function(e,t){q(-1),performance.now();var a=I(m[n],t),o=(performance.now(),I(r,e-i(n)));if(void 0!==o){var l=f.get(a);performance.now();var s=u[n].filter(function(e){return d[e].visible=d[e][o]===l[o],d[e].visible});s.forEach(function(e,t){d[e].__i[n+1]=t}),performance.now();var v=u.slice(0,n+1);v.push(s),c.updateData(v,y),C(c.getVisible())}}(e.mouse(e.event.target)[0],t)}).on("mouseout",M).attr("class","brush").call(g.get(n)).selectAll("rect").attr("width",o(r.domain()[r.domain().length-1],n)+1.1*r.bandwidth()),a.exit().remove()}function F(t){var n=e.mouse(e.event.target)[1],a=e.mouse(e.event.target)[0],o=I(m[t.level],n),l=I(r,a-i(t.level)),s=f.get(o);E.select(".nvTooltip").attr("transform","translate("+a+","+(n+20)+")").call(function(e){e.select(".tool_id").text(o),e.select(".tool_value_name").text(l+" : "),e.select(".tool_value_val").text(s[l])})}function M(){E.select(".nvTooltip").attr("transform","translate(-200,-200)").call(function(e){e.select(".tool_id").text(""),e.select(".tool_value_name").text(""),e.select(".tool_value_val").text("")})}function B(t){e.event.sourceEvent.shiftKey&&e.select(this.parentNode).attr("transform",function(t){return"translate("+(e.event.x+c.attribFontSize/2)+","+m[t.level].range()[0]+")"})}function W(t){e.event.sourceEvent.shiftKey&&e.select(this.parentNode).attr("transform",function(t){return"translate("+(e.event.x+c.attribFontSize/2)+","+m[t.level].range()[0]+")"})}function N(t){if(e.event.sourceEvent.shiftKey){var n,a=I(r,e.event.x+c.attribFontSize/2-i(t.level));e.select(this.parentNode).attr("transform",function(e){return"translate("+o(e.attrib,e.level)+","+m[e.level].range()[0]+")"}),a!==t.attrib&&(n=p.indexOf(a),K(t.attrib,n),c.updateData(u))}}function V(e,t,n,a){s.beginPath(),e.forEach(function(e,t){0===t?s.moveTo(e.x,e.y):s.lineTo(e.x,e.y)}),s.lineWidth=t,a?(s.fillStyle=n,s.closePath(),s.fill()):(s.strokeStyle=n,s.stroke())}function K(e,t){var n=p.indexOf(e);-1!==n?t>p.length||t<0?console.err("moveAttrToPos pos out of bounds",t,p.length):(p.splice(n,1),p.splice(t,0,e)):console.err("moveAttrToPos attr not found",e)}return l.height=b*z,(s=l.getContext("2d")).scale(z,z),s.imageSmoothingEnabled=s.mozImageSmoothingEnabled=s.webkitImageSmoothingEnabled=!1,s.globalCompositeOperation="source-over",c.initData=function(t,n){performance.now(),(y=n).keys().forEach(function(e){v.set(e,!0)}),f=e.map();for(var a=0;a<d.length;a++){var r=d[a];r.__seqId=a,f.set(r[k],r),r.__i={},r.__i[0]=a}performance.now()},c.updateData=function(t,n,a){var o;performance.now(),typeof t==typeof[]?(y=void 0!==n?n:y,u=t,function(t){performance.now();var n=u.length-1;m.splice(n+1,m.length),m[t=void 0!==t?t:n]=e.scaleBand().range([T,b-c.margin-30]).paddingInner(0).paddingOuter(0);var a=[];if(u[t].length>b){var o=Math.max(Math.floor(u[t].length/(2*b)),1);u[t].itemsPerpixel=o;for(var l=0;l<u[t].length;l+=o)a.push(u[t][l])}else u[t].itemsPerpixel=1,a=u[t];u[t].representatives=a,m[t].domain(a.map(function(e){return d[e][k]})),v.keys().forEach(function(t){if("visible"!==t){var n=y.get(t);n.domain(e.extent(u[0].representatives.map(function(e){return d[e][t]}))),y.set(t,n)}}),r.domain(p).range([0,c.attribWidth*v.keys().length]).paddingInner(.1).paddingOuter(0),i.domain(u.map(function(e,t){return t})).range([S+c.margin,(r.range()[1]+c.levelsSeparation)*u.length+S]).paddingInner(0).paddingOuter(0),performance.now()}(a),o=i.range()[1]+c.margin+S,e.select(l).attr("width",o).attr("height",b).style("width",o).style("height",b+"px"),l.style.width=o+"px",l.style.height=b+"px",E.attr("width",o).attr("height",b),c.update(),performance.now()):console.error("navio updateData didn't receive an array")},c.update=function(){performance.now();var t,n,a,l,v,g,x=i.range()[1]+c.margin+S;s.clearRect(0,0,x+1,b+1),u.forEach(function(e,t){var n;!function(e){s.beginPath(),s.rect(i(e),m[e].range()[0]-1,r.range()[1]+1,m[e].range()[1]+2-100),s.strokeStyle="black",s.lineWidth=1,s.stroke()}(t),e.representatives.forEach(function(e){!function(e,t){var n,a,i;for(m[t].bandwidth(),c.divisionsThreshold,a=0;a<p.length;a++)if(n=p[a],i=Math.round(m[t](e[k])+m[t].bandwidth()/2),s.beginPath(),s.moveTo(Math.round(o(n,t)),i),s.lineTo(Math.round(o(n,t)+r.bandwidth()),i),s.lineWidth=Math.ceil(m[t].bandwidth())+1,s.strokeStyle=void 0===e[n]||null===e[n]||""===e[n]||"none"===e[n]?"white":y.get(n)(e[n]),s.stroke(),m[t].bandwidth()>2*c.divisionsThreshold){var l=Math.round(m[t](e[k]));s.beginPath(),s.moveTo(o(n,t),l),s.lineTo(o(n,t)+r.bandwidth(),l),s.lineWidth=1,s.strokeStyle=c.divisionsColor,s.stroke()}}(d[e],t)}),(n=t)<=0||u[n].representatives.forEach(function(e){var t=f.get(d[e][k]).__i[n-1],a=Math.floor(t-t%u[n-1].itemsPerpixel),o={x:i(n-1)+r.range()[1],y:m[n-1](d[u[n-1][a]][k])},l={x:i(n),y:m[n](d[e][k])},s=[o,{x:o.x+.3*c.levelsSeparation,y:o.y},{x:l.x-.3*c.levelsSeparation,y:l.y},l,{x:l.x,y:l.y+m[n].bandwidth()},{x:l.x-.3*c.levelsSeparation,y:l.y+m[n].bandwidth()},{x:o.x+.3*c.levelsSeparation,y:o.y+m[n-1].bandwidth()},{x:o.x,y:o.y+m[n-1].bandwidth()},o];V(s,1,c.levelConvectionsColor),V(s,1,c.levelConvectionsColor,!0)})}),t=r.domain(),n=E.select(".attribs").selectAll(".levelOverlay").data(u),a=n.enter().append("g").attr("class","levelOverlay").attr("id",function(e,t){return"level"+t}).each(D),l=a.merge(n).selectAll(".attribOverlay").data(function(e,n){return t.map(function(e){return{attrib:e,level:n}})}),(v=l.enter().append("g").attr("class","attribOverlay").style("cursor","pointer")).merge(l).attr("transform",function(e){return"translate("+o(e.attrib,e.level)+","+m[e.level].range()[0]+")"}),v.append("rect").merge(l.select("rect")).attr("fill","none").attr("x",0).attr("y",0).attr("width",function(){return 1.1*r.bandwidth()}).attr("height",function(e){return m[e.level].range()[1]-m[e.level].range()[0]}),v.append("text").merge(l.select("text")).style("cursor","point").style("-webkit-user-select","none").style("-moz-user-select","none").style("-ms-user-select","none").style("user-select","none").text(function(e){return"__seqId"===e.attrib?"sequential Index":e.attrib}).attr("x",r.bandwidth()/2).attr("y",0).style("font-weight",function(e){return h.has(e.level)&&h.get(e.level)===e.attrib?"bolder":"normal"}).style("font-family","sans-serif").style("font-size",c.attribFontSize+"px").on("click",O).call(e.drag().container(v.merge(l).node()).on("start",B).on("drag",W).on("end",N)).on("mousemove",function(){var t=e.select(this);(t=void 0!==t.transition?t.transition().duration(150):t).style("font-size",c.attribFontSizeSelected+"px")}).on("mouseout",function(){var t=e.select(this);(t=void 0!==t.transition?t.transition().duration(150):t).style("font-size",c.attribFontSize+"px")}).attr("transform","rotate(-45)"),a.append("text").attr("class","numNodesLabel").style("font-family","sans-serif").style("pointer-events","none").merge(n.select(".numNodesLabel")).attr("y",function(e,t){return m[t].range()[1]+15}).attr("x",function(e,t){return i(t)}).text(function(e){return _(e.length)}),l.exit().remove(),n.exit().remove(),g=u.length-1,E.select("#closeButton").style("display",1===u.length?"none":"block").attr("transform","translate("+(i(g)+i.bandwidth()-c.levelsSeparation+15)+","+m[g].range()[0]+")"),performance.now()},c.addAttrib=function(e,t){if(-1===p.indexOf(e))return p.push(e),y.set(e,t),c},c.addSequentialAttrib=function(t,n){return c.addAttrib(t,n||e.scaleSequential(x).domain(void 0!==d&&d.length>0?e.extent(d,function(e){return e[t]}):[0,1])),c},c.addCategoricalAttrib=function(t,n){return c.addAttrib(t,n||e.scaleOrdinal(e.schemeCategory10)),c},c.data=function(t){return y.has("visible")||(c.addAttrib("visible",e.scaleOrdinal().domain([!1,!0]).range(w)),K("visible",0)),y.has("__seqId")||(c.addSequentialAttrib("__seqId"),K("__seqId",1)),arguments.length?(t.forEach(function(e){e.visible=!0}),u=[(d=t).map(function(e,t){return t})],c.initData(u,y),c.updateData(u,y),c):d[0]},c.getVisible=function(){return u[u.length-1].filter(function(e){return d[e].visible}).map(function(e){return d[e]})},c.updateCallback=function(e){return arguments.length?(C=e,c):C},c.visibleColorRange=function(e){return arguments.length?(w=e,c):w},c.defaultColorInterpolator=function(e){return arguments.length?(x=e,c):x},c.id=function(e){return arguments.length?(k=e,c):k},c}});
